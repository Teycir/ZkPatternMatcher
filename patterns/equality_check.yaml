patterns:
  # Pattern: Double equals (==) instead of constraint (===)
  # Detects: signal == value (comparison, not constraint)
  - id: comparison_instead_of_constraint
    kind: regex
    pattern: '\b\w+(?:\[[^\]]+\])?\s*==\s*\w+(?:\[[^\]]+\])?'
    message: >
      CRITICAL: Double equals (==) detected. In Circom, == is a comparison
      operator that returns a boolean, NOT a constraint. Use === for
      constraints. The pattern 'signal == value;' does not add any constraint
      to the circuit - it's a no-op that allows the prover to set signal to
      any value. Replace with: signal === value;
    severity: critical

  # Pattern: Assignment operator (=) in circuit context
  # Detects: signal = value (variable assignment, not circuit constraint)
  - id: assignment_in_circuit_context
    kind: regex
    pattern: 'signal\s+\w+\s*=\s*[^=]'
    message: >
      HIGH: Single equals (=) after signal keyword. This is variable
      assignment syntax, not a circuit constraint. For signals, use:
      <== (constrained assignment), <-- (unconstrained assignment), or
      === (constraint only). The = operator does not create constraints.
    severity: high

  # Pattern: Bare hint assignment (simplified orphaned detection)
  - id: bare_hint_assignment
    kind: regex
    pattern: '^\s*\w[\w\[\]]*\s*<--\s*[^;=]+;\s*$'
    message: >
      HIGH: Unconstrained assignment (<--) with no constraint on the same line.
      Every <-- hint must be paired with a === constraint (either on the same
      line or immediately following). If no === is present, the prover can
      substitute any value for this signal.
      Safe pattern:  out <-- compute(x); out * out === x;
      Danger signal: out <-- compute(x);   â† this fires here
    severity: high

  # Pattern: Hint with inline constraint (safe pattern - info only)
  - id: hint_with_inline_constraint
    kind: regex
    pattern: '<--.*==='
    message: >
      INFO: Hint assignment (<--) and constraint (===) appear on the same line.
      This is a common safe pattern. Verify the constraint expression matches
      the computation on the RHS of <--.
    severity: info

  # Pattern: Correct constraint operator usage (positive detection)
  - id: correct_constraint_operator
    kind: regex
    pattern: '\w+\s*<==\s*\w+'
    message: >
      INFO: Constrained assignment operator (<==) detected. This is the
      correct pattern for assigning and constraining a signal simultaneously.
      Equivalent to: signal <-- value; signal === value;
    severity: info

invariants:
  - name: no_comparison_operators
    invariant_type: constraint
    relation: "no_double_equals_in_constraints"
    oracle: must_hold
    severity: critical
    description: "Circuit constraints must use === not == for equality"

  - name: every_hint_is_constrained
    invariant_type: constraint
    relation: "lhs_of_hint_has_constraint"
    oracle: must_hold
    severity: high
    description: "Every signal assigned via <-- must have a corresponding === constraint"
